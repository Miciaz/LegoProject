"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6568],{22852:function(e,t,n){var i=n(95235),r=n(2784);const a=new Map,o="undefined"!==typeof IntersectionObserver?new IntersectionObserver((e=>{e.forEach((e=>{const t=a.get(e.target);void 0!==t&&t(e)}))}),{rootMargin:"0px",threshold:[0,.25,.5,.75,1]}):void 0;class s extends r.Component{constructor(...e){super(...e),(0,i.Z)(this,"isIntersecting",!1),(0,i.Z)(this,"intersectionRatio",null),(0,i.Z)(this,"recsTest",null),(0,i.Z)(this,"onIntersection",(e=>{const{threshold:t=0}=this.props,n=.25*Math.round(4*e.intersectionRatio),i=e.isIntersecting&&n>=t;i!==this.isIntersecting&&(this.isIntersecting=i,this.props.onIntersection(i)),n!==this.intersectionRatio&&void 0!==this.props.onUpdate?(this.intersectionRatio=n,this.props.onUpdate({isIntersecting:e.isIntersecting,intersectionRatio:n})):this.intersectionRatio=null})),(0,i.Z)(this,"onRef",(e=>{var t,n;e&&(void 0!==this.unobserve&&this.unobserve(),this.unobserve=(t=e,n=this.onIntersection,void 0===o?()=>{}:(o.observe(t),a.set(t,n),()=>{o.unobserve(t),a.delete(t)})))})),(0,i.Z)(this,"observerProps",{onRef:this.onRef})}componentWillUnmount(){void 0!==this.unobserve&&this.unobserve()}render(){const{children:e}=this.props;return e(this.observerProps)}}t.Z=s},6568:function(e,t,n){n.r(t),n.d(t,{default:function(){return E}});var i=n(95235),r=n(2784),a=n(10869),o=n.n(a),s=n(86235),d=n(76951),l=n(26907),c=n(33266),m=n(51261);let u;!function(e){e.RecsEngine="recs_engine"}(u||(u={}));var v=n(82954),p=n(78395),k=n(89001),y=n(22852),b=n(93395),f=n(6918),h=n(14507);const g=o()(b.Z,(e=>e.recommendations.maxItemsSent))||10;var N=n(58421);const I=()=>{const e=(0,N.wt)(),{pageType:t}=(0,N.yZ)(),{0:n,1:i}=(0,r.useState)(!1);return{reportRecsLoaded:r=>{r&&!n&&e&&(i(!0),e.logRecsLoaded({data:{page_type:t,recommendation_id:r}}))},handleInteraction:(n,i)=>{i&&e&&e.logRecsAdded({data:{page_type:t,recommendation_id:i,interaction_type:"click",product_id:n}})},handleIntersection:(n,i,r)=>{n&&i&&e&&r&&e.logRecsDisplayed({data:{page_type:t,recommendation_id:i,recs_displayed_fraction:r}})}}};function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var w=n(46842),T=n(18729),C=n(73091);const P=C.ZP.div.withConfig({displayName:"ProductRecommendationsstyles__Wrapper",componentId:"sc-1anuv2e-0"})(["margin:0 auto;margin-top:",";padding:",";background:",";",";",";"],(e=>e.theme.sizing("lg")),(e=>e.theme.sizing("ms")),(e=>e.theme.color("white")),(e=>e.theme.media.min("small")((0,C.iv)(["padding-top:",";padding-bottom:",";"],e.theme.sizing("lg"),e.theme.sizing("lg")))),(e=>e.theme.media.min("medium")((0,C.iv)(["padding:"," "," "," ",";max-width:",";margin:auto;"],e.theme.sizing("lg"),e.theme.sizing("xxl"),e.theme.sizing("xxl"),e.theme.sizing("xxl"),e.theme.maxWidth())))),S=C.ZP.div.withConfig({displayName:"ProductRecommendationsstyles__Container",componentId:"sc-1anuv2e-1"})(["padding:0;width:100%;max-width:100%;",";"],(e=>e.theme.media.min("massive")((0,C.iv)(["background:",";"],e.theme.color("white")))));var D=n(52322);var j=({id:e,recommendations:t,onRef:n,titleData:i,onCart:a,visibilityTracking:o})=>{const{handleInteraction:s}=I(),l=(0,d.T)(),{isCmsContent:c=!1,title:u,showTitle:v=!1}=i,p=(0,m.aq)("cart_mandd_gbl_recommender_header_20558"),k=(0,r.useMemo)((()=>t.map((e=>({product:e})))),[t]),y=c?u:a?"on_variant_b"===p?l("recommended.title.alsoBought"):"on_variant_c"===p?l("recommended.title.nextBuild"):u||l("recommended.title"):l("recommended.title");return(0,D.jsx)(S,{children:(0,D.jsx)(P,{"data-test":"product-recommended",ref:n,children:(0,D.jsx)(T.Z,{title:y,showTitle:c&&v||!c,"data-test":"recommendations",products:k,visibilityTracking:o,renderProduct:t=>(0,D.jsx)(w.Z,{recommendationId:e,componentType:"CarouselProductLeaf",product:t.product,onClickLink:()=>{s(t.product.productCode,e)},onCart:a,useOldActionButton:!0})})})})};var _=({onRef:e})=>(0,D.jsx)("div",{"data-test":"product-recommended",ref:e}),R=n(86473);const A={kind:"Document",definitions:(e=>{const t={};return e.filter((e=>{if("FragmentDefinition"!==e.kind)return!0;const n=e.name.value;return!t[n]&&(t[n]=!0,!0)}))})([{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ProductRecommendedQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"siteArea"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RecommendationSiteAreas"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"productCode"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"cartItems"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"wishlistItems"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentlyViewed"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sessionCookieId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"crossSessionCookieId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"limit"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"12"},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orderedItems"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"cartTotalValue"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"freeDeliveryThreshold"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visitorGUID"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recommender"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"Variable",name:{kind:"Name",value:"limit"}}},{kind:"Argument",name:{kind:"Name",value:"siteArea"},value:{kind:"Variable",name:{kind:"Name",value:"siteArea"}}},{kind:"Argument",name:{kind:"Name",value:"productCode"},value:{kind:"Variable",name:{kind:"Name",value:"productCode"}}},{kind:"Argument",name:{kind:"Name",value:"cartItems"},value:{kind:"Variable",name:{kind:"Name",value:"cartItems"}}},{kind:"Argument",name:{kind:"Name",value:"wishlistItems"},value:{kind:"Variable",name:{kind:"Name",value:"wishlistItems"}}},{kind:"Argument",name:{kind:"Name",value:"recentlyViewedItems"},value:{kind:"Variable",name:{kind:"Name",value:"recentlyViewed"}}},{kind:"Argument",name:{kind:"Name",value:"orderedItems"},value:{kind:"Variable",name:{kind:"Name",value:"orderedItems"}}},{kind:"Argument",name:{kind:"Name",value:"sessionCookieId"},value:{kind:"Variable",name:{kind:"Name",value:"sessionCookieId"}}},{kind:"Argument",name:{kind:"Name",value:"crossSessionCookieId"},value:{kind:"Variable",name:{kind:"Name",value:"crossSessionCookieId"}}},{kind:"Argument",name:{kind:"Name",value:"cartTotalValue"},value:{kind:"Variable",name:{kind:"Name",value:"cartTotalValue"}}},{kind:"Argument",name:{kind:"Name",value:"freeDeliveryThreshold"},value:{kind:"Variable",name:{kind:"Name",value:"freeDeliveryThreshold"}}},{kind:"Argument",name:{kind:"Name",value:"visitorGUID"},value:{kind:"Variable",name:{kind:"Name",value:"visitorGUID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"recommendations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"Product_ProductItem"},directives:[]}]}}]}}]}}].concat(R.o.definitions)),loc:{start:0,end:930,source:{body:"\n  query ProductRecommendedQuery(\n    $siteArea: RecommendationSiteAreas!\n    $productCode: String\n    $cartItems: [String!]\n    $wishlistItems: [String!]\n    $recentlyViewed: [String!]\n    $sessionCookieId: String!\n    $crossSessionCookieId: String\n    $limit: Int = 12\n    $orderedItems: [String!]\n    $cartTotalValue: Int\n    $freeDeliveryThreshold: Int\n    $visitorGUID: String\n  ) {\n    recommender(\n      limit: $limit\n      siteArea: $siteArea\n      productCode: $productCode\n      cartItems: $cartItems\n      wishlistItems: $wishlistItems\n      recentlyViewedItems: $recentlyViewed\n      orderedItems: $orderedItems\n      sessionCookieId: $sessionCookieId\n      crossSessionCookieId: $crossSessionCookieId\n      cartTotalValue: $cartTotalValue\n      freeDeliveryThreshold: $freeDeliveryThreshold\n      visitorGUID: $visitorGUID\n    ) {\n      id\n      recommendations {\n        ...Product_ProductItem\n      }\n    }\n  }\n\n  \n",name:"GraphQL request",locationOffset:{line:1,column:1}}}};function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=e=>{const{productCode:t,siteArea:n,isCmsContent:i=!1,title:a,showTitle:b=!1,onIntersection:N,orderedItems:O,cartTotalValue:w,freeDeliveryThreshold:T}=e,{fetched:C,recommendationData:P,renderRecommendations:S}=((e,t)=>{const n=(0,r.useContext)(h._y),i=(0,l.v)(),{lists:a}=(0,f.v)(),s={recentlyViewed:n?n.reduce(((t,n)=>(n.productCode&&e!==n.productCode&&t.push(n.productCode),t)),[]).slice(0,g):(console.warn("No recently viewed products available"),[]),cartItems:i.cart?(o()(i,(e=>e.cart.lineItems))||[]).map((e=>e&&e.product.productCode)):[],wishlistItems:(()=>{if(!(0,m.wF)("recommendations")||!a)return[];const e=[];for(const t of a.results)e.push(...t.lineItems.map((e=>{var t;return null===(t=e.product)||void 0===t?void 0:t.productCode})));return e.filter(Boolean)})(),orderedItems:t?t.slice(0,g):[]},d=i&&i.__typename&&!0===i.isOver18yo;return{fetched:!!i.fetched&&(!i.isLid||void 0!==a),recommendationData:s,renderRecommendations:!!d}})(t,O),R=(0,s.xJ)(),x=(0,d.T)(),E=(0,l.v)().isLid,{trackEvent:L}=(()=>{const{triggerEvent:e}=(0,m.FG)();return{trackEvent:(0,r.useCallback)((t=>{e({label:"personalisationEvent",eventType:["custom"],data:{id:t.id,source:t.source,segmentLvl1:t.segmentLvl1,segmentLvl2:t.segmentLvl2},options:{queue:!0}})}),[e])}})(),{reportRecsLoaded:Z,handleIntersection:G}=I(),{0:U,1:F}=(0,r.useState)(null),{0:B,1:q}=(0,r.useState)(!1),z=(0,r.useRef)(U),M=(0,r.useRef)(!0),{0:Q,1:H}=(0,r.useState)(void 0),{0:W,1:Y}=(0,r.useState)(null),{0:J,1:K}=(0,r.useState)(!1),{0:X,1:ee}=(0,r.useState)("");let te;const ne=async e=>{const t=e.listGetAll;if(0===t.count||!t.results||0===t.results.length)return void re(!0);const n=t.results[0],i=n.lineItems.filter((e=>e.productVariant&&!0===e.productVariant.attributes.canAddToBag?e:null)).slice(0,12);i.length<4?re(!0):(ee(`${x("recommended.recentWishlist.title")} ${n.name}`),H(n.id),Y(i.map((({product:e,productVariant:t})=>V(V({},e),{},{variant:V(V({},t),{},{attributes:V({},t.attributes),price:V({},t.price)})})))))},ie=e=>{const t=e&&e.recommender;if(!t)return;const{recommendations:i}=t,r=i&&i.length?i.filter((e=>{const t=(e=>"SingleVariantProduct"===e.__typename?o()(e,(e=>e.variant)):"MultiVariantProduct"===e.__typename?o()(e,(e=>e.variants[0])):null)(e);return t&&t.attributes&&t.attributes.canAddToBag})):[];ee("recommended.title"),Y(r),H(t.id),L({id:t.id,source:u.RecsEngine,segmentLvl1:"product_recommender_carousel",segmentLvl2:n})},re=i=>{if(!S)return;te&&(te.unsubscribe(),te=void 0);const r=(0,v.n0)(),a=(0,v.d9)(),o=(0,m.wF)("recommendations"),s=(0,v.Uv)();if(!r||!e.siteArea)return;let d=$({siteArea:n,productCode:t,cartTotalValue:w,freeDeliveryThreshold:T,sessionCookieId:""},P);o&&(d=$($({},d),{},{sessionCookieId:r,crossSessionCookieId:a,visitorGUID:s}));if(!0!==i&&"SHOPPING_CART"===n&&E){const e=R.watchQuery({query:p.UY,fetchPolicy:"network-only",variables:{input:{sortBy:"lastModifiedAt",sortOrder:"descending"}}});te=e.subscribe((e=>{e.data&&!e.errors&&ne(e.data)}))}else te=void R.watchQuery({query:A,fetchPolicy:"network-only",nextFetchPolicy:"cache-first",variables:d}).subscribe((e=>{e.data&&!e.errors&&ie(e.data)}))};if((0,c.F)((()=>{K(!0)})),(0,r.useEffect)((()=>Z(Q)),[Q,Z]),(0,r.useEffect)((()=>{if(C)return re(),()=>{te&&te.unsubscribe()}}),[C,t,n,S]),(0,r.useEffect)((()=>{B&&U&&Q&&(M.current||z.current&&z.current<U)&&(z.current=U,M.current=!1,G(B,Q,U))}),[Q,G,U,B,z]),!J||!Q||!W)return null;const ae=Q&&(!W||!W.length);return S?(0,D.jsx)(y.Z,{onIntersection:e=>(e=>{q(e),N&&N()})(e),children:({onRef:e})=>ae?(0,D.jsx)(_,{onRef:e}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(j,{productCode:t,onRef:e,id:Q,recommendations:W,titleData:{isCmsContent:i,showTitle:b,title:"SHOPPING_CART"===n?X:a},onCart:"SHOPPING_CART"===n,visibilityTracking:e=>(e=>{F(e)})(e)}),(0,D.jsx)(k.Bh,{})]})}):null}},14507:function(e,t,n){n.d(t,{_y:function(){return u}});var i=n(95235),r=n(2784),a=n(5632),o=n(82954),s=n(13351),d=n(33266),l=n(52322);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const u=(0,r.createContext)([]),v="RecentlyViewed:Products";t.ZP={Provider:({children:e,currentlyViewedProduct:t})=>{const{query:{locale:n}}=(0,a.useRouter)(),i=(0,r.useRef)((0,o.hH)());i.current||(0,s.GI)(v);const c=i.current?(0,s.BL)(v)||[]:(0,s.Gg)(v)||[],{0:p,1:k}=(0,r.useState)(c);(0,d.F)((()=>{t&&y(t)})),(0,r.useEffect)((()=>{i?((0,s.xU)(v,p),(0,s.Z3)(v)):((0,s.GI)(v),(0,s.KY)(v,p))}),[p]);const y=e=>{if(p[0]===e)return;const t=[m({locale:n},e),...p.filter((t=>t.id!==e.id))].slice(0,10);k(t)},b=p.filter((e=>e.locale===n));return(0,l.jsx)(u.Provider,{value:b,children:e})},Consumer:u.Consumer}}}]);
//# sourceMappingURL=6568-e9afb53f36323779.js.map